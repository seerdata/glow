!function t(e,n,r){function o(i,u){if(!n[i]){if(!e[i]){var a="function"==typeof require&&require;if(!u&&a)return a(i,!0);if(s)return s(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[i]={exports:{}};e[i][0].call(h.exports,function(t){var n=e[i][1][t];return o(n?n:t)},h,h.exports,t,e,n,r)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function s(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function u(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!s(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,s,a,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],u(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,a=0;r>a;a++)l[a].apply(this,s);return!0},r.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(n=u(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,s,u;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,r=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(u=s;u-- >0;)if(n[u]===e||n[u].listener&&n[u].listener===e){r=u;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],o(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){var r;r=function(){function t(){}return t._NONCE_TAG="__nc",t._SKEY_TAG="storage_key",t._DEF_ROOT=".v1.stor.vlt12",t.RELAY_TOKEN_LEN=32,t.RELAY_TOKEN_TIMEOUT=6e4,t.RELAY_SESSION_TIMEOUT=3e5,t.RELAY_AJAX_TIMEOUT=5e3,t}(),e.exports=r},{}],3:[function(t,e,n){var r,o,s,i;r=t("config"),s=t("keys"),i=t("nacl"),o=function(){function t(t,e){this.storageKey=null!=t?t:null,null==e&&(e=null),this.root=e?"."+e+r._DEF_ROOT:r._DEF_ROOT,this.storageKey||this._loadKey(),this.storageKey||this.newKey()}return t.prototype.tag=function(t){return t&&t+this.root},t.prototype._saveKey=function(){return this._set(r._SKEY_TAG,this.storageKey.toString())},t.prototype._loadKey=function(){var t;return t=this._get(r._SKEY_TAG),t?this.setKey(s.fromString(t)):void 0},t.prototype.selfDestruct=function(t){return t?this._localRemove(this.tag(r._SKEY_TAG)):void 0},t.prototype.setKey=function(t){return this.storageKey=t,this._saveKey()},t.prototype.newKey=function(){return this.setKey(i.makeSecretKey())},t.prototype.save=function(t,e){var n,o,s;return t&&e?(o=i.use(),e=o.encode_utf8(JSON.stringify(e)),s=o.crypto_secretbox_random_nonce(),n=o.crypto_secretbox(e,s,this.storageKey.key),this._set(t,n.toBase64()),this._set(r._NONCE_TAG+"."+t,s.toBase64()),!0):null},t.prototype.get=function(t){var e,n,o,s;return(n=this._get(t))&&(s=this._get(r._NONCE_TAG+"."+t))?(o=i.use(),e=o.crypto_secretbox_open(n.fromBase64(),s.fromBase64(),this.storageKey.key),JSON.parse(o.decode_utf8(e))):null},t.prototype.remove=function(t){var e,n,o,s;for(o=[t,r._NONCE_TAG+"."+t],e=0,n=o.length;n>e;e++)s=o[e],this._localRemove(this.tag(s));return!0},t.prototype._get=function(t){return this._localGet(this.tag(t))},t.prototype._set=function(t,e){return t&&e?(this._localSet(this.tag(t),e),e):null},t.prototype._localGet=function(t){return this._storage().get(t)||null},t.prototype._localSet=function(t,e){return this._storage().set(t,e)},t.prototype._localRemove=function(t){return this._storage().remove(t)},t.prototype._storage=function(){return t._storageDriver||t.startStorageSystem(),t._storageDriver},t._storageDriver=null,t.startStorageSystem=function(t){if(!t)throw new Error("The driver parameter cannot be empty.");return this._storageDriver=t},t}(),e.exports=o},{config:2,keys:6,nacl:10}],4:[function(t,e,n){var r,o;o=t("nacl"),r=function(){function t(t,e,n){var r,o,s,i;if(this.id=t,this.keyRing=e,null==n&&(n=null),!this.id||!this.keyRing)throw new Error("KeyRatchet - missing params");for(s=this._roles,r=0,o=s.length;o>r;r++)i=s[r],this[i]=this.keyRing.getKey(this.keyTag(i));n&&this.startRatchet(n)}return t.prototype.lastKey=null,t.prototype.confirmedKey=null,t.prototype.nextKey=null,t.prototype._roles=["lastKey","confirmedKey","nextKey"],t.prototype.keyTag=function(t){return t+"_"+this.id},t.prototype.storeKey=function(t){return this.keyRing.saveKey(this.keyTag(t),this[t])},t.prototype.startRatchet=function(t){var e,n,r,s;for(s=["confirmedKey","lastKey"],e=0,r=s.length;r>e;e++)n=s[e],this[n]||(this[n]=t,this.storeKey(n));return this.nextKey?void 0:(this.nextKey=o.makeKeyPair(),this.storeKey("nextKey"))},t.prototype.pushKey=function(t){var e,n,r,o,s;for(this.lastKey=this.confirmedKey,this.confirmedKey=this.nextKey,this.nextKey=t,r=this._roles,o=[],e=0,n=r.length;n>e;e++)s=r[e],o.push(this.storeKey(s));return o},t.prototype.confKey=function(t){var e,n,r,o;if(null!=this.confirmedKey&&this.confirmedKey.equal(t))return!1;for(this.lastKey=this.confirmedKey,this.confirmedKey=t,r=["lastKey","confirmedKey"],e=0,n=r.length;n>e;e++)o=r[e],this.storeKey(o);return!0},t.prototype.curKey=function(){return this.confirmedKey?this.confirmedKey:this.lastKey},t.prototype.h2LastKey=function(){return o.h2(this.lastKey.boxPk)},t.prototype.h2ConfirmedKey=function(){return o.h2(this.confirmedKey.boxPk)},t.prototype.h2NextKey=function(){return o.h2(this.nextKey.boxPk)},t.prototype.keyByHash=function(t){var e,n,r,s;for(r=this._roles,e=0,n=r.length;n>e;e++)if(s=r[e],o.h2(this[s].boxPk)===t)return this[s]},t.prototype.isNextKeyHash=function(t){return this.h2NextKey().equal(t)},t.prototype.toStr=function(){return JSON.stringify(this).toBase64()},t.prototype.fromStr=function(t){return Utils.extend(this,JSON.parse(t.fromBase64()))},t.prototype.selfDestruct=function(t){var e,n,r,o,s;if(!t)return null;for(r=this._roles,o=[],e=0,n=r.length;n>e;e++)s=r[e],o.push(this.keyRing.deleteKey(this.keyTag(s)));return o},t}(),e.exports=r,window.__CRYPTO_DEBUG&&(window.KeyRatchet=r)},{nacl:10}],5:[function(t,e,n){var r,o,s,i,u,a,l,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;r=t("config"),o=t("crypto_storage"),u=t("keys"),a=t("nacl"),l=t("utils"),s=t("events").EventEmitter,i=function(t){function e(t,e){var n;null==e&&(e=null),e&&(n=u.fromString(e),this.storage=new o(n,t)),this.storage||(this.storage=new o(null,t)),this._ensureKeys()}return h(e,t),e.prototype._ensureKeys=function(){return this._loadCommKey(),this._loadGuestKeys()},e.prototype._loadCommKey=function(){return this.commKey=this.getKey("comm_key"),this.commKey?void 0:(this.commKey=a.makeKeyPair(),this.saveKey("comm_key",this.commKey))},e.prototype._loadGuestKeys=function(){var t,e,n,r,o;for(this.registry=this.storage.get("guest_registry")||[],this.guestKeys={},r=this.registry,o=[],t=0,e=r.length;e>t;t++)n=r[t],o.push(this.guestKeys[n]=this.storage.get("guest["+n+"]"));return o},e.prototype.commFromSeed=function(t){return this.commKey=a.fromSeed(a.encode_utf8(t)),this.storage.save("comm_key",this.commKey.toString())},e.prototype.commFromSecKey=function(t){return this.commKey=a.fromSecretKey(t),this.storage.save("comm_key",this.commKey.toString())},e.prototype.tagByHpk=function(t){var e,n,r;n=this.guestKeys;for(e in n)if(c.call(n,e)&&(r=n[e],t===a.h2(r.fromBase64()).toBase64()))return e},e.prototype.getMasterKey=function(){return this.storage.storageKey.key2str("key")},e.prototype.getPubCommKey=function(){return this.commKey.strPubKey()},e.prototype.saveKey=function(t,e){return this.storage.save(t,e.toString()),e},e.prototype.getKey=function(t){var e;return e=this.storage.get(t),e?u.fromString(e):null},e.prototype.deleteKey=function(t){return this.storage.remove(t)},e.prototype._addRegistry=function(t){return t?this.registry.indexOf(t)>-1?void 0:this.registry.push(t):null},e.prototype._saveNewGuest=function(t,e){return t&&e?(this.storage.save("guest["+t+"]",e),this.storage.save("guest_registry",this.registry)):null},e.prototype._removeGuestRecord=function(t){var e;return t?(this.storage.remove("guest["+t+"]"),e=this.registry.indexOf(t),e>-1?(this.registry.splice(e,1),this.storage.save("guest_registry",this.registry)):void 0):null},e.prototype.addGuest=function(t,e){return t&&e?(e=e.trimLines(),this._addRegistry(t),this.guestKeys[t]=e,this._saveNewGuest(t,e)):null},e.prototype.addTempGuest=function(t,e){return t&&e?(e=e.trimLines(),this.guestKeys[t]=e,l.delay(r.RELAY_SESSION_TIMEOUT,function(e){return function(){return delete e.guestKeys[t],e.emit("tempGuestTimeout",{strGuestTag:t})}}(this))):null},e.prototype.removeGuest=function(t){return t&&this.guestKeys[t]?(this.guestKeys[t]=null,delete this.guestKeys[t],this._removeGuestRecord(t)):null},e.prototype.getGuestKey=function(t){return t&&this.guestKeys[t]?new u({boxPk:this.getGuestRecord(t).fromBase64()}):null},e.prototype.getGuestRecord=function(t){return t&&this.guestKeys[t]?this.guestKeys[t]:null},e.prototype.selfDestruct=function(t){var e,n,r,o;if(!t)return null;for(o=this.registry.slice(),n=0,r=o.length;r>n;n++)e=o[n],this.removeGuest(e);return this.storage.remove("guest_registry"),this.storage.remove("comm_key"),this.storage.selfDestruct(t)},e}(s),e.exports=i,window.__CRYPTO_DEBUG&&(window.KeyRing=i)},{config:2,crypto_storage:3,events:1,keys:6,nacl:10,utils:14}],6:[function(t,e,n){var r,o,s={}.hasOwnProperty;o=t("utils"),r=function(){function t(t){t&&o.extend(this,t)}return t.prototype.toString=function(){return JSON.stringify(this.constructor.keys2str(this))},t.fromString=function(t){return t?this.str2keys(JSON.parse(t.trimLines())):null},t.prototype.key2str=function(t){return t&&null!=this[t]?this[t].toBase64():null},t.prototype.strPubKey=function(){return this.boxPk.toBase64()},t.prototype.strSecKey=function(){return this.boxSk.toBase64()},t.prototype.equal=function(t){return this.strPubKey()!==t.strPubKey()?!1:null!=this.boxSk!=(null!=t.boxSk)?!1:null!=this.boxSk?this.strSecKey()===t.strSecKey():!0},t.keys2str=function(e){var n,r,o;r=new t;for(n in e)s.call(e,n)&&(o=e[n],r[n]=o.toBase64());return r},t.str2keys=function(e){var n,r,o;r=new t;for(n in e)s.call(e,n)&&(o=e[n],r[n]=o.fromBase64());return r},t}(),e.exports=r,window.__CRYPTO_DEBUG&&(window.Keys=r)},{utils:14}],7:[function(t,e,n){var r,o,s,i,u,a,l=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;r=t("config"),s=t("keyring"),u=t("nacl"),a=t("utils"),o=t("events").EventEmitter,i=function(t){function e(t,e){this.identity=t,null==e&&(e=null),this.keyRing=new s(this.identity,e),this.sessionKeys={},this.sessionRelay={},this.sessionTimeout={}}return l(e,t),e.fromSeed=function(t,n,r){var o;return null==n&&(n=t),null==r&&(r=null),o=new e(n,r),o.keyRing.commFromSeed(t),o._hpk=null,o},e.fromSecKey=function(t,n,r){var o;return null==r&&(r=null),o=new e(n,r),o.keyRing.commFromSecKey(t),o._hpk=null,o},e.prototype.hpk=function(){return this._hpk?this._hpk:this._hpk=u.h2(this.keyRing.commKey.boxPk)},e.prototype.getPubCommKey=function(){return this.keyRing.getPubCommKey()},e.prototype.createSessionKey=function(t){if(!t)throw new Error("createSessionKey - no sess_id");return null!=this.sessionKeys[t]?this.sessionKeys[t]:(this.sessionKeys[t]=u.makeKeyPair(),this.sessionTimeout[t]=a.delay(r.RELAY_SESSION_TIMEOUT,function(e){return function(){return e.sessionKeys[t]=null,delete e.sessionKeys[t],e.sessionTimeout[t]=null,delete e.sessionTimeout[t],e.sessionRelay[t]=null,delete e.sessionRelay[t],e.emit("sessionTimeout",t)}}(this)),this.sessionKeys[t])},e.prototype.isConnectedToRelay=function(t){var e;if(null==t&&(t=this.lastRelay),!t)throw new Error("relayDelete - no open relay");return this.lastRelay=t,e="relay_"+t.url,!!this.sessionRelay[e]},e.prototype.rawEncodeMessage=function(t,e,n){var r,o;if(null==t||null==e||null==n)throw new Error("rawEncodeMessage: missing params");return r=this._makeNonce(),o={nonce:r.toBase64(),ctext:u.use().crypto_box(this._parseData(t),r,e,n).toBase64()}},e.prototype.rawDecodeMessage=function(t,e,n,r){var o;if(null==t||null==e||null==n||null==r)throw new Error("rawEncodeMessage: missing params");return o=u.use(),JSON.parse(o.decode_utf8(o.crypto_box_open(e,t,n,r)))},e.prototype.encodeMessage=function(t,e,n,r){var o,s;if(null==n&&(n=!1),null==r&&(r=null),null==t||null==e)throw new Error("encodeMessage: missing params");if(null==(o=this._gPk(t)))throw new Error("encodeMessage: don't know guest "+t);return s=this._getSecretKey(t,n,r),this.rawEncodeMessage(e,o,s)},e.prototype.decodeMessage=function(t,e,n,r,o){var s,i;if(null==r&&(r=!1),null==o&&(o=null),null==t||null==e||null==n)throw new Error("decodeMessage: missing params");if(null==(s=this._gPk(t)))throw new Error("decodeMessage: don't know guest "+t);return i=this._getSecretKey(t,r,o),this.rawDecodeMessage(e.fromBase64(),n.fromBase64(),s,i)},e.prototype.connectToRelay=function(t){return t.openConnection().then(function(e){return function(){return t.connectMailbox(e).then(function(){return e.lastRelay=t})}}(this))},e.prototype.sendToVia=function(t,e,n){return this.connectToRelay(e).then(function(r){return function(){return r.relaySend(t,n,e)}}(this))},e.prototype.getRelayMessages=function(t){return this.connectToRelay(t).then(function(e){return function(){return e.relayMessages(t)}}(this))},e.prototype.relayCount=function(t){if(null==t&&(t=this.lastRelay),!t)throw new Error("relayCount - no open relay");return this.lastRelay=t,t.count(this).then(function(e){return function(){return e.count=parseInt(t.result)}}(this))},e.prototype.relaySend=function(t,e,n){var r;if(null==n&&(n=this.lastRelay),!n)throw new Error("mbx: relaySend - no open relay");return this.lastRelay=n,r=this.encodeMessage(t,e),this.lastMsg=r,n.upload(this,u.h2(this._gPk(t)),r)},e.prototype.relayMessages=function(t){if(null==t&&(t=this.lastRelay),!t)throw new Error("relayMessages - no open relay");return this.lastRelay=t,t.download(this).then(function(e){return function(){var n,r,o,s,i,u;for(n=[],i=t.result,o=0,s=i.length;s>o;o++)r=i[o],(u=e.keyRing.tagByHpk(r.from))&&(r.fromTag=u,r.msg=e.decodeMessage(u,r.nonce,r.data),null!=r.msg&&delete r.data),n.push(r);return e.lastDownload=n,n}}(this))},e.prototype.relayNonceList=function(t){if(null==t&&(t=this.lastDownload),!t)throw new Error("relayNonceList - no metadata");return a.map(t,function(t){return t.nonce})},e.prototype.relayDelete=function(t,e){if(null==e&&(e=this.lastRelay),!e)throw new Error("relayDelete - no open relay");return this.lastRelay=e,e["delete"](this,t)},e.prototype.clean=function(t){return this.getRelayMessages(t).then(function(e){return function(n){return e.relayDelete(e.relayNonceList(n),t)}}(this))},e.prototype.selfDestruct=function(t){return t?this.keyRing.selfDestruct(t):null},e.prototype._gKey=function(t){return t?this.keyRing.getGuestKey(t):null},e.prototype._gPk=function(t){var e;return t?null!=(e=this._gKey(t))?e.boxPk:void 0:null},e.prototype._gHpk=function(t){return t?u.h2(this._gPk(t)):null},e.prototype._getSecretKey=function(t,e,n){return n?this._gPk(n):e?this.sessionKeys[t].boxSk:this.keyRing.commKey.boxSk},e.prototype._parseData=function(t){return"Uint8Array"===a.type(t)?t:u.use().encode_utf8(JSON.stringify(t))},e.prototype._makeNonce=function(t){var e,n,r,o,s,i;if(null==t&&(t=parseInt(Date.now()/1e3)),s=u.use().crypto_box_random_nonce(),null==s||24!==s.length)throw new Error("RNG failed, try again?");for(e=a.itoa(t),n=r=0;7>=r;n=++r)s[n]=0;for(n=o=0,i=e.length-1;i>=0?i>=o:o>=i;n=i>=0?++o:--o)s[8-e.length+n]=e[n];return s},e}(o),e.exports=i,window.__CRYPTO_DEBUG&&(window.MailBox=i)},{config:2,events:1,keyring:5,nacl:10,utils:14}],8:[function(t,e,n){e.exports={Utils:t("utils"),Mixins:t("mixins"),Nacl:t("nacl"),Keys:t("keys"),SimpleStorageDriver:t("test_driver"),CryptoStorage:t("crypto_storage"),KeyRing:t("keyring"),MailBox:t("mailbox"),Relay:t("relay"),RachetBox:t("rachetbox"),Config:t("config"),startStorageSystem:function(t){return this.CryptoStorage.startStorageSystem(t)},setAjaxImpl:function(t){return this.Utils.setAjaxImpl(t)}},window&&(window.glow=e.exports)},{config:2,crypto_storage:3,keyring:5,keys:6,mailbox:7,mixins:9,nacl:10,rachetbox:11,relay:12,test_driver:13,utils:14}],9:[function(t,e,n){var r,o,s,i,u;for(o=t("utils"),o.include(String,{toCodeArray:function(){var t,e,n,r;for(n=[],t=0,e=this.length;e>t;t++)r=this[t],n.push(r.charCodeAt());return n},toUTF8:function(){return unescape(encodeURIComponent(this))},fromUTF8:function(){return decodeURIComponent(escape(this))},toUint8Array:function(){return new Uint8Array(this.toUTF8().toCodeArray())},toUint8ArrayRaw:function(){return new Uint8Array(this.toCodeArray())},fromBase64:function(){return new Uint8Array(atob(this).toCodeArray())},trimLines:function(){return this.replace("\r\n","").replace("\n","").replace("\r","")}}),u=[Array,Uint8Array,Uint16Array],s=0,i=u.length;i>s;s++)r=u[s],o.include(r,{fromCharCodes:function(){var t;return function(){var e,n,r;for(r=[],e=0,n=this.length;n>e;e++)t=this[e],r.push(String.fromCharCode(t));return r}.call(this).join("")},toBase64:function(){return btoa(this.fromCharCodes())},xorWith:function(t){var e,n;return this.length!==t.length?null:new Uint8Array(function(){var r,o,s;for(s=[],n=r=0,o=this.length;o>r;n=++r)e=this[n],s.push(e^t[n]);return s}.call(this))},equal:function(t){var e,n,r,o;if(this.length!==t.length)return!1;for(e=n=0,r=this.length;r>n;e=++n)if(o=this[e],o!==t[e])return!1;return!0}});o.include(Uint8Array,{concat:function(t){var e;return e=new Uint8Array(this.byteLength+t.byteLength),e.set(new Uint8Array(this),0),e.set(t,this.byteLength),e},fillWith:function(t){var e,n,r,o;for(e=n=0,r=this.length;r>n;e=++n)o=this[e],this[e]=t;return this}}),e.exports={}},{utils:14}],10:[function(t,e,n){var r,o,s,i;i="undefined"!=typeof nacl_factory&&null!==nacl_factory?nacl_factory:t("js-nacl"),r=t("keys"),s=t("utils"),o=function(){function t(){}return t.HEAP_SIZE=Math.pow(2,23),t._instance=null,t._unloadTimer=null,t.use=function(){return this._unloadTimer&&clearTimeout(this._unloadTimer),this._unloadTimer=setTimeout(function(){return t.unload()},15e3),window.__naclInstance||(window.__naclInstance=i.instantiate(this.HEAP_SIZE)),window.__naclInstance},t.unload=function(){return this._unloadTimer=null,window.__naclInstance=null,delete window.__naclInstance},t.makeSecretKey=function(){return new r({key:this.use().random_bytes(this.use().crypto_secretbox_KEYBYTES)})},t.random=function(t){return null==t&&(t=32),this.use().random_bytes(t)},t.makeKeyPair=function(){return new r(this.use().crypto_box_keypair())},t.fromSecretKey=function(t){return new r(this.use().crypto_box_keypair_from_raw_sk(t))},t.fromSeed=function(t){return new r(this.use().crypto_box_keypair_from_seed(t))},t.sha256=function(t){return this.use().crypto_hash_sha256(t)},t.to_hex=function(t){return this.use().to_hex(t)},t.from_hex=function(t){return this.use().from_hex(t)},t.encode_utf8=function(t){return this.use().encode_utf8(t)},t.decode_utf8=function(t){return this.use().decode_utf8(t)},t.h2=function(t){var e;return"String"===s.type(t)&&(t=t.toUint8ArrayRaw()),e=new Uint8Array(32+t.length),e.fillWith(0),e.set(t,32),this.sha256(this.sha256(e))},t.h2_64=function(e){return t.h2(e.fromBase64()).toBase64()},t}(),e.exports=o,window.__CRYPTO_DEBUG&&(window.Nacl=o)},{"js-nacl":void 0,keys:6,utils:14}],11:[function(t,e,n){var r,o,s,i,u,a,l,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;l=t("utils"),u=t("nacl"),s=t("keys"),o=t("keyring"),r=t("keyratchet"),i=t("mailbox"),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype._loadRatchets=function(t){var e;return e=this._gHpk(t).toBase64(),this.krLocal=new r("local_"+e+"_for_"+this.hpk().toBase64(),this.keyRing,this.keyRing.commKey),this.krGuest=new r("guest_"+e+"_for_"+this.hpk().toBase64(),this.keyRing,this.keyRing.getGuestKey(t))},e.prototype.relaySend=function(t,e){var n,r;if(!this.lastRelay)throw new Error("rbx: relaySend - no open relay");if(!t||!e)throw new Error("rbx: relaySend - missing params");return this._loadRatchets(t),r={org_msg:e},null==e.got_key&&(r.nextKey=this.krLocal.nextKey.strPubKey()),null==e.got_key?(n=this.rawEncodeMessage(r,this.krGuest.confirmedKey.boxPk,this.krLocal.confirmedKey.boxSk),this.lastMsg=n):n=this.rawEncodeMessage(r,this.krGuest.lastKey.boxPk,this.krLocal.confirmedKey.boxSk),this.lastRelay.upload(this,u.h2(this._gPk(t)),n)},e.prototype._tryKeypair=function(t,e,n,r){var o,s;try{return this.rawDecodeMessage(t.fromBase64(),e.fromBase64(),n,r)}catch(s){return o=s,null}},e.prototype.decodeMessage=function(t,n,r,o,s){var i,u,a,l,h,c;if(null==o&&(o=!1),null==s&&(s=null),o)return e.__super__.decodeMessage.call(this,t,n,r,o,s);if(null==t||null==n||null==r)throw new Error("decodeMessage: missing params");for(this._loadRatchets(t),a=[[this.krGuest.confirmedKey.boxPk,this.krLocal.confirmedKey.boxSk],[this.krGuest.lastKey.boxPk,this.krLocal.lastKey.boxSk],[this.krGuest.confirmedKey.boxPk,this.krLocal.lastKey.boxSk],[this.krGuest.lastKey.boxPk,this.krLocal.confirmedKey.boxSk]],i=u=0,h=a.length;h>u;i=++u)if(l=a[i],c=this._tryKeypair(n,r,l[0],l[1]),null!=c)return c;return console.log("RatchetBox decryption failed: message from unknown guest or ratchet out of sync"),null},e.prototype.relayMessages=function(){return e.__super__.relayMessages.call(this).then(function(t){return function(){var e,n,r,o,i,a,l,h,c;for(h=[],o=t.lastDownload,e=0,n=o.length;n>e;e++)r=o[e],r.fromTag&&(t._loadRatchets(r.fromTag),null!=(null!=(i=r.msg)?i.nextKey:void 0)&&t.krGuest.confKey(new s({boxPk:r.msg.nextKey.fromBase64()}))&&h.push({toTag:r.fromTag,key:r.msg.nextKey,msg:{got_key:u.h2_64(r.msg.nextKey)}}),null!=(null!=(a=r.msg)&&null!=(l=a.org_msg)?l.got_key:void 0)&&(r.msg=r.msg.org_msg,t.krLocal.isNextKeyHash(r.msg.got_key.fromBase64())&&t.krLocal.pushKey(u.makeKeyPair()),r.msg=null),null!=r.msg&&(r.msg=r.msg.org_msg));return(c=function(){var e;return h.length>0?(e=h.shift(),t.relaySend(e.toTag,e.msg).then(function(){return c()})):void 0})()}}(this))},e.prototype.selfDestruct=function(t,n){var r,o,s,i;if(null==n&&(n=!1),t){if(n)for(i=this.keyRing.registry,o=0,s=i.length;s>o;o++)r=i[o],this._loadRatchets(r),this.krLocal.selfDestruct(n),this.krGuest.selfDestruct(n);return e.__super__.selfDestruct.call(this,t)}},e}(i),e.exports=a,window.__CRYPTO_DEBUG&&(window.RatchetBox=a)},{keyratchet:4,keyring:5,keys:6,mailbox:7,nacl:10,utils:14}],12:[function(t,e,n){var r,o,s,i,u,a,l=function(t,e){return function(){return t.apply(e,arguments)}},h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty,y=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};r=t("config"),s=t("keys"),i=t("nacl"),a=t("utils"),o=t("events").EventEmitter,u=function(t){function e(t){this.url=null!=t?t:null,this._ajax=l(this._ajax,this),this._resetState(),this.lastError=null,this.RELAY_COMMANDS=["count","upload","download","delete"]}return h(e,t),e.prototype.openConnection=function(){return this.getServerToken().then(function(t){return function(){return t.getServerKey()}}(this))},e.prototype.getServerToken=function(){if(!this.url)throw new Error("getServerToken - no url");if(this.lastError=null,this.clientToken||(this.clientToken=i.random(r.RELAY_TOKEN_LEN)),this.clientToken&&this.clientToken.length!==r.RELAY_TOKEN_LEN)throw new Error("Token must be "+r.RELAY_TOKEN_LEN+" bytes");return this._ajax("start_session",this.clientToken.toBase64()).then(function(t){return function(e){var n;return n=t._processData(e),t.relayToken=n[0].fromBase64(),t.diff=2===n.length?parseInt(n[1]):0,t._scheduleExpireSession(r.RELAY_TOKEN_TIMEOUT),t.diff>4&&console.log("Relay "+t.url+" requested difficulty "+t.diff+". Session handshake may take longer."),t.diff>16?console.log("Attempting handshake at difficulty "+t.diff+"! This may take a while"):void 0}}(this))},e.prototype.getServerKey=function(){var t,e,n;if(!(this.url&&this.clientToken&&this.relayToken))throw new Error("getServerKey - missing params");if(this.lastError=null,this.h2ClientToken=i.h2(this.clientToken).toBase64(),t=this.clientToken.concat(this.relayToken),0===this.diff)n=i.h2(t).toBase64();else{for(e=i.random(32);!a.arrayZeroBits(i.h2(t.concat(e)),this.diff);)e=i.random(32);n=e.toBase64()}return this._ajax("verify_session",this.h2ClientToken+"\r\n"+n+"\r\n").then(function(t){return function(e){var n;return n=e.fromBase64(),t.relayKey=new s({boxPk:n}),t.online=!0}}(this))},e.prototype.connectMailbox=function(t){var e,n,r,o,s,u,a;if(null==t||!this.online||null==this.relayKey||null==this.url)throw new Error("connectMailbox - missing params");return this.lastError=null,u="relay_"+this.url,e=t.createSessionKey(u).boxPk,t.keyRing.addTempGuest(u,this.relayKey.strPubKey()),delete this.relayKey,o=e.toBase64(),a=e.concat(this.relayToken).concat(this.clientToken),n=i.h2(a),r=t.encodeMessage(u,n),r.pub_key=t.keyRing.getPubCommKey(),s=t.encodeMessage("relay_"+this.url,r,!0),this._ajax("prove",this.h2ClientToken+"\r\n"+(o+"\r\n")+(s.nonce+"\r\n")+(""+s.ctext)).then(function(t){return function(t){return u}}(this))},e.prototype.runCmd=function(t,e,n){var r,o;if(null==n&&(n=null),null==t||null==e)throw new Error("runCmd - missing params");if(y.call(this.RELAY_COMMANDS,t)<0)throw new Error("Relay "+this.url+" doesn't support "+t);return r={cmd:t},n&&(r=a.extend(r,n)),o=e.encodeMessage("relay_"+this.url,r,!0),this._ajax("command",e.hpk().toBase64()+"\r\n"+(o.nonce+"\r\n")+(""+o.ctext)).then(function(n){return function(r){if("upload"!==t){if(null==r)throw new Error(n.url+" - "+t+" error");return"count"===t||"download"===t?n.result=n._processResponse(r,e,t):n.result=JSON.parse(r)}}}(this))},e.prototype._processResponse=function(t,e,n){var r,o,s;if(o=this._processData(t),2!==o.length)throw new Error(this.url+" - "+n+": Bad response");return s=o[0],r=o[1],e.decodeMessage("relay_"+this.url,s,r,!0)},e.prototype._processData=function(t){var e;return e=t.split("\r\n"),e.length>=2||(e=t.split("\n")),e},e.prototype.count=function(t){return this.runCmd("count",t)},e.prototype.upload=function(t,e,n){return this.runCmd("upload",t,{to:e.toBase64(),payload:n})},e.prototype.download=function(t){return this.runCmd("download",t)},e.prototype["delete"]=function(t,e){return this.runCmd("delete",t,{payload:e})},e.prototype._resetState=function(){return this.clientToken=null,this.online=!1,this.relayToken=null,this.relayKey=null,this.clientTokenExpiration=null},e.prototype._scheduleExpireSession=function(t){return this.clientTokenExpiration&&clearTimeout(this.clientTokenExpiration),this.clientTokenExpiration=setTimeout(function(t){return function(){return t._resetState(),t.emit("sessionExpired")}}(this),t)},e.prototype._ajax=function(t,e){return a.ajax(this.url+"/"+t,e)},e}(o),e.exports=u,window.__CRYPTO_DEBUG&&(window.Relay=u)},{config:2,events:1,keys:6,nacl:10,utils:14}],13:[function(t,e,n){var r;r=function(){function t(t,e){null==t&&(t="storage."),null==e&&(e=null),this._root_tag="__glow."+t,this._load(e)}return t.prototype._state=null,t.prototype._key_tag=function(t){return this._root_tag+"."+t},t.prototype.get=function(t){return this._state||this._load(),this._state[t]?this._state[t]:JSON.parse(localStorage.getItem(this._key_tag(t)))},t.prototype.set=function(t,e){return this._state||this._load(),this._state[t]=e,localStorage.setItem(this._key_tag(t),JSON.stringify(e)),this._persist()},t.prototype.remove=function(t){return this._state||this._load(),delete this._state[t],localStorage.removeItem(this._key_tag(t)),this._persist()},t.prototype._persist=function(){},t.prototype._load=function(t){return null==t&&(t=null),this._state=t?t:{},console.log("INFO: SimpleTestDriver uses localStorage and should not be used in production for permanent key storage.")},t}(),e.exports=r},{}],14:[function(t,e,n){var r,o;r=t("config"),o=function(){function t(){}return t.extend=function(t,e){var n,r;if("undefined"!=typeof $&&null!==$?$.extend:void 0)return $.extend(t,e);for(n in e)r=e[n],void 0!==e[n]&&(t[n]=e[n]);return t},t.map=function(t,e){return("undefined"!=typeof $&&null!==$?$.map:void 0)?"undefined"!=typeof $&&null!==$?$.map(t,e):void 0:Array.prototype.map.apply(t,[e])},t.include=function(t,e){return this.extend(t.prototype,e)},t.type=function(t){return void 0===t?"undefined":null===t?"null":Object.prototype.toString.call(t).replace("[","").replace("]","").split(" ")[1]},t.ajaxImpl=null,t.setAjaxImpl=function(t){return this.ajaxImpl=t},t.ajax=function(t,e){if(null===this.ajaxImpl)if("undefined"!=typeof Q&&null!==Q?Q.xhr:void 0)this.setAjaxImpl(function(t,e){return Q.xhr({method:"POST",url:t,headers:{Accept:"text/plain","Content-Type":"text/plain"},data:e,responseType:"text",timeout:r.RELAY_AJAX_TIMEOUT,disableUploadProgress:!0}).then(function(t){return t.data})});else{if(!(("undefined"!=typeof $&&null!==$?$.ajax:void 0)&&("undefined"!=typeof $&&null!==$?$.Deferred:void 0)))throw new Error("ajax implementation not set; use q-xhr or $http");console.log("default ajax impl: setting to zepto with promises"),this.setAjaxImpl(function(t,e){return $.ajax({url:t,type:"POST",dataType:"text",timeout:r.RELAY_AJAX_TIMEOUT,context:this,
error:console.log,contentType:"text/plain",data:e})})}return this.ajaxImpl(t,e)},t.delay=function(t,e){return setTimeout(e,t)},t.itoa=function(t){var e,n,r,o,s,i;return 0>=t?new Uint8Array(function(){var t,e;for(e=[],n=t=0;7>=t;n=++t)e.push(0);return e}()):(s=[Math.floor,Math.pow,Math.log],e=s[0],o=s[1],r=s[2],i=e(r(t)/r(256)),new Uint8Array(function(){var r,s,u;for(u=[],n=r=s=i;0>=s?0>=r:r>=0;n=0>=s?++r:--r)u.push(e(t/o(256,n))%256);return u}()))},t.firstZeroBits=function(t,e){return t===t>>e<<e},t.arrayZeroBits=function(t,e){var n,r,o,s,i;for(i=e,r=o=0,s=1+e/8;s>=0?s>=o:o>=s;r=s>=0?++o:--o){if(n=t[r],0>=i)return!0;if(!(i>8))return this.firstZeroBits(n,i);if(i-=8,n>0)return!1}return!1},t.logStack=function(t){var e,n,r,o,s,i;for(t||(t=new Error("stackLog")),s=t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n"),o=[],e=n=0,r=s.length;r>n;e=++n)i=s[e],o.push(console.log(e+": "+i));return o},t}(),e.exports=o,window.__CRYPTO_DEBUG&&(window.Utils=o)},{config:2}]},{},[8]);